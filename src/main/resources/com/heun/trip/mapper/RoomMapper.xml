<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.heun.trip.dao.RoomDao">
  
  <!-- <resultMap type="room" id="roomMap">
    <id column="rms_id" property="no"/>
    <result column="rm_name" property="name"/>
    <result column="rm_chge" property="price"/>
    <result column="max_ple" property="maxPerson"/>
    <result column="post_code" property="postNo"/>
    <result column="addr" property="address"/>
    <result column="dtil_addr" property="detailAddress"/>
    <result column="lati" property="latitude"/>
    <result column="longi" property="longitude"/>
    <result column="rule" property="rule"/>
    <result column="map" property="map"/>
    <result column="cacl_gde" property="cancelGuide"/>
    <result column="cdt" property="createdDate"/>
    <result column="plty_gde" property="penaltyGuide"/>
    <result column="grd" property="grade"/>
    <result column="thumbnail" property="thumbnail"/>
  </resultMap>
  
  <resultMap type="room" id="roomPhotoMap">
    <id column="rms_id" property="no"/>
    <result column="rm_name" property="name"/>
    <result column="rm_chge" property="price"/>
    <result column="max_ple" property="maxPerson"/>
    <result column="post_code" property="postNo"/>
    <result column="addr" property="address"/>
    <result column="dtil_addr" property="detailAddress"/>
    <result column="lati" property="latitude"/>
    <result column="longi" property="longitude"/>
    <result column="rule" property="rule"/>
    <result column="map" property="map"/>
    <result column="cacl_gde" property="cancelGuide"/>
    <result column="cdt" property="createdDate"/>
    <result column="plty_gde" property="penaltyGuide"/>
    <result column="grd" property="grade"/>
    
  <association property="host" javaType="member">
    <id column="usr_id"  property="no"/>
    <result column="name"    property="name"/>
    <result column="tel"    property="tel"/>
    <result column="usr_photo"  property="photo"/>
  </association>
    
  <collection property="photos" ofType="roomFile"> 
    <id column="r_photo_id" property="no"/>
    <result column="rms_id"  property="RoomNo"/>
    <result column="rm_photo" property="path"/>
  </collection>
  
  <collection property="Facilities" ofType="Facilities"> 
    <id column="amn_id" property="no"/>
    <result column="amn"  property="name"/>
  </collection>
  
  </resultMap> -->
  
  
  <select id="findAll" resultMap="roomMap" parameterType="map">
    select
      r.rms_id,
      r.rm_name,
      r.rm_chge,
      r.grd,
      p.rm_photo as thumbnail
    from
      rms r
    left outer join rm_photo p on r.rms_id=p.rms_id
    where
      p.rm_photo like '%thumbnail%'
    order by
      r.rms_id desc
    <if test="size != null and rowNo != null">
      limit #{rowNo}, #{size}
    </if>
  </select>
 
  <select id="countAll" resultType="int">
    select count(*) from rms
  </select>
  
  <select id="findByNo" resultMap="roomPhotoMap" parameterType="int">
    select
        r.rms_id,
        r.rm_name,
        r.rm_chge,
        r.max_ple,
        r.post_code,
        r.addr,
        r.dtil_addr,
        r.lati,
        r.longi,
        r.rule,
        r.map,
        r.cacl_gde,
        r.cdt,
        r.plty_gde,
        r.grd,
        u.usr_id,
        u.tel,
        u.name,
        u.usr_photo,
        p.r_photo_id,
        p.rms_id,
        p.rm_photo,
        a.amn_id,
        a.amn
    from rms r
        left outer join usr u on r.usr_id=u.usr_id
        left outer join rm_photo p on r.rms_id=p.rms_id
        left outer join rms_amn ra on r.rms_id=ra.rms_id
        left outer join amn a on ra.amn_id=a.amn_id
    where
        r.rms_id=#{value}
  </select>
  
</mapper>     










